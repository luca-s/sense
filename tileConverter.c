
#include "general.h"
#include "tileConverter.h"
#include "ppu.h"
#include "display.h"

byte tileConverterPlane0_1[256][4] =
{ { 0, 0, 0, 0 },
  { 1, 0, 0, 0 },
  { 0, 1, 0, 0 },
  { 1, 1, 0, 0 },
  { 0, 0, 1, 0 },
  { 1, 0, 1, 0 },
  { 0, 1, 1, 0 },
  { 1, 1, 1, 0 },
  { 0, 0, 0, 1 },
  { 1, 0, 0, 1 },
  { 0, 1, 0, 1 },
  { 1, 1, 0, 1 },
  { 0, 0, 1, 1 },
  { 1, 0, 1, 1 },
  { 0, 1, 1, 1 },
  { 1, 1, 1, 1 },
  { 2, 0, 0, 0 },
  { 3, 0, 0, 0 },
  { 2, 1, 0, 0 },
  { 3, 1, 0, 0 },
  { 2, 0, 1, 0 },
  { 3, 0, 1, 0 },
  { 2, 1, 1, 0 },
  { 3, 1, 1, 0 },
  { 2, 0, 0, 1 },
  { 3, 0, 0, 1 },
  { 2, 1, 0, 1 },
  { 3, 1, 0, 1 },
  { 2, 0, 1, 1 },
  { 3, 0, 1, 1 },
  { 2, 1, 1, 1 },
  { 3, 1, 1, 1 },
  { 0, 2, 0, 0 },
  { 1, 2, 0, 0 },
  { 0, 3, 0, 0 },
  { 1, 3, 0, 0 },
  { 0, 2, 1, 0 },
  { 1, 2, 1, 0 },
  { 0, 3, 1, 0 },
  { 1, 3, 1, 0 },
  { 0, 2, 0, 1 },
  { 1, 2, 0, 1 },
  { 0, 3, 0, 1 },
  { 1, 3, 0, 1 },
  { 0, 2, 1, 1 },
  { 1, 2, 1, 1 },
  { 0, 3, 1, 1 },
  { 1, 3, 1, 1 },
  { 2, 2, 0, 0 },
  { 3, 2, 0, 0 },
  { 2, 3, 0, 0 },
  { 3, 3, 0, 0 },
  { 2, 2, 1, 0 },
  { 3, 2, 1, 0 },
  { 2, 3, 1, 0 },
  { 3, 3, 1, 0 },
  { 2, 2, 0, 1 },
  { 3, 2, 0, 1 },
  { 2, 3, 0, 1 },
  { 3, 3, 0, 1 },
  { 2, 2, 1, 1 },
  { 3, 2, 1, 1 },
  { 2, 3, 1, 1 },
  { 3, 3, 1, 1 },
  { 0, 0, 2, 0 },
  { 1, 0, 2, 0 },
  { 0, 1, 2, 0 },
  { 1, 1, 2, 0 },
  { 0, 0, 3, 0 },
  { 1, 0, 3, 0 },
  { 0, 1, 3, 0 },
  { 1, 1, 3, 0 },
  { 0, 0, 2, 1 },
  { 1, 0, 2, 1 },
  { 0, 1, 2, 1 },
  { 1, 1, 2, 1 },
  { 0, 0, 3, 1 },
  { 1, 0, 3, 1 },
  { 0, 1, 3, 1 },
  { 1, 1, 3, 1 },
  { 2, 0, 2, 0 },
  { 3, 0, 2, 0 },
  { 2, 1, 2, 0 },
  { 3, 1, 2, 0 },
  { 2, 0, 3, 0 },
  { 3, 0, 3, 0 },
  { 2, 1, 3, 0 },
  { 3, 1, 3, 0 },
  { 2, 0, 2, 1 },
  { 3, 0, 2, 1 },
  { 2, 1, 2, 1 },
  { 3, 1, 2, 1 },
  { 2, 0, 3, 1 },
  { 3, 0, 3, 1 },
  { 2, 1, 3, 1 },
  { 3, 1, 3, 1 },
  { 0, 2, 2, 0 },
  { 1, 2, 2, 0 },
  { 0, 3, 2, 0 },
  { 1, 3, 2, 0 },
  { 0, 2, 3, 0 },
  { 1, 2, 3, 0 },
  { 0, 3, 3, 0 },
  { 1, 3, 3, 0 },
  { 0, 2, 2, 1 },
  { 1, 2, 2, 1 },
  { 0, 3, 2, 1 },
  { 1, 3, 2, 1 },
  { 0, 2, 3, 1 },
  { 1, 2, 3, 1 },
  { 0, 3, 3, 1 },
  { 1, 3, 3, 1 },
  { 2, 2, 2, 0 },
  { 3, 2, 2, 0 },
  { 2, 3, 2, 0 },
  { 3, 3, 2, 0 },
  { 2, 2, 3, 0 },
  { 3, 2, 3, 0 },
  { 2, 3, 3, 0 },
  { 3, 3, 3, 0 },
  { 2, 2, 2, 1 },
  { 3, 2, 2, 1 },
  { 2, 3, 2, 1 },
  { 3, 3, 2, 1 },
  { 2, 2, 3, 1 },
  { 3, 2, 3, 1 },
  { 2, 3, 3, 1 },
  { 3, 3, 3, 1 },
  { 0, 0, 0, 2 },
  { 1, 0, 0, 2 },
  { 0, 1, 0, 2 },
  { 1, 1, 0, 2 },
  { 0, 0, 1, 2 },
  { 1, 0, 1, 2 },
  { 0, 1, 1, 2 },
  { 1, 1, 1, 2 },
  { 0, 0, 0, 3 },
  { 1, 0, 0, 3 },
  { 0, 1, 0, 3 },
  { 1, 1, 0, 3 },
  { 0, 0, 1, 3 },
  { 1, 0, 1, 3 },
  { 0, 1, 1, 3 },
  { 1, 1, 1, 3 },
  { 2, 0, 0, 2 },
  { 3, 0, 0, 2 },
  { 2, 1, 0, 2 },
  { 3, 1, 0, 2 },
  { 2, 0, 1, 2 },
  { 3, 0, 1, 2 },
  { 2, 1, 1, 2 },
  { 3, 1, 1, 2 },
  { 2, 0, 0, 3 },
  { 3, 0, 0, 3 },
  { 2, 1, 0, 3 },
  { 3, 1, 0, 3 },
  { 2, 0, 1, 3 },
  { 3, 0, 1, 3 },
  { 2, 1, 1, 3 },
  { 3, 1, 1, 3 },
  { 0, 2, 0, 2 },
  { 1, 2, 0, 2 },
  { 0, 3, 0, 2 },
  { 1, 3, 0, 2 },
  { 0, 2, 1, 2 },
  { 1, 2, 1, 2 },
  { 0, 3, 1, 2 },
  { 1, 3, 1, 2 },
  { 0, 2, 0, 3 },
  { 1, 2, 0, 3 },
  { 0, 3, 0, 3 },
  { 1, 3, 0, 3 },
  { 0, 2, 1, 3 },
  { 1, 2, 1, 3 },
  { 0, 3, 1, 3 },
  { 1, 3, 1, 3 },
  { 2, 2, 0, 2 },
  { 3, 2, 0, 2 },
  { 2, 3, 0, 2 },
  { 3, 3, 0, 2 },
  { 2, 2, 1, 2 },
  { 3, 2, 1, 2 },
  { 2, 3, 1, 2 },
  { 3, 3, 1, 2 },
  { 2, 2, 0, 3 },
  { 3, 2, 0, 3 },
  { 2, 3, 0, 3 },
  { 3, 3, 0, 3 },
  { 2, 2, 1, 3 },
  { 3, 2, 1, 3 },
  { 2, 3, 1, 3 },
  { 3, 3, 1, 3 },
  { 0, 0, 2, 2 },
  { 1, 0, 2, 2 },
  { 0, 1, 2, 2 },
  { 1, 1, 2, 2 },
  { 0, 0, 3, 2 },
  { 1, 0, 3, 2 },
  { 0, 1, 3, 2 },
  { 1, 1, 3, 2 },
  { 0, 0, 2, 3 },
  { 1, 0, 2, 3 },
  { 0, 1, 2, 3 },
  { 1, 1, 2, 3 },
  { 0, 0, 3, 3 },
  { 1, 0, 3, 3 },
  { 0, 1, 3, 3 },
  { 1, 1, 3, 3 },
  { 2, 0, 2, 2 },
  { 3, 0, 2, 2 },
  { 2, 1, 2, 2 },
  { 3, 1, 2, 2 },
  { 2, 0, 3, 2 },
  { 3, 0, 3, 2 },
  { 2, 1, 3, 2 },
  { 3, 1, 3, 2 },
  { 2, 0, 2, 3 },
  { 3, 0, 2, 3 },
  { 2, 1, 2, 3 },
  { 3, 1, 2, 3 },
  { 2, 0, 3, 3 },
  { 3, 0, 3, 3 },
  { 2, 1, 3, 3 },
  { 3, 1, 3, 3 },
  { 0, 2, 2, 2 },
  { 1, 2, 2, 2 },
  { 0, 3, 2, 2 },
  { 1, 3, 2, 2 },
  { 0, 2, 3, 2 },
  { 1, 2, 3, 2 },
  { 0, 3, 3, 2 },
  { 1, 3, 3, 2 },
  { 0, 2, 2, 3 },
  { 1, 2, 2, 3 },
  { 0, 3, 2, 3 },
  { 1, 3, 2, 3 },
  { 0, 2, 3, 3 },
  { 1, 2, 3, 3 },
  { 0, 3, 3, 3 },
  { 1, 3, 3, 3 },
  { 2, 2, 2, 2 },
  { 3, 2, 2, 2 },
  { 2, 3, 2, 2 },
  { 3, 3, 2, 2 },
  { 2, 2, 3, 2 },
  { 3, 2, 3, 2 },
  { 2, 3, 3, 2 },
  { 3, 3, 3, 2 },
  { 2, 2, 2, 3 },
  { 3, 2, 2, 3 },
  { 2, 3, 2, 3 },
  { 3, 3, 2, 3 },
  { 2, 2, 3, 3 },
  { 3, 2, 3, 3 },
  { 2, 3, 3, 3 },
  { 3, 3, 3, 3 } };

byte tileConverterPlane2_3[256][4] =
{ {  0,  0,  0,  0 },
  {  4,  0,  0,  0 },
  {  0,  4,  0,  0 },
  {  4,  4,  0,  0 },
  {  0,  0,  4,  0 },
  {  4,  0,  4,  0 },
  {  0,  4,  4,  0 },
  {  4,  4,  4,  0 },
  {  0,  0,  0,  4 },
  {  4,  0,  0,  4 },
  {  0,  4,  0,  4 },
  {  4,  4,  0,  4 },
  {  0,  0,  4,  4 },
  {  4,  0,  4,  4 },
  {  0,  4,  4,  4 },
  {  4,  4,  4,  4 },
  {  8,  0,  0,  0 },
  { 12,  0,  0,  0 },
  {  8,  4,  0,  0 },
  { 12,  4,  0,  0 },
  {  8,  0,  4,  0 },
  { 12,  0,  4,  0 },
  {  8,  4,  4,  0 },
  { 12,  4,  4,  0 },
  {  8,  0,  0,  4 },
  { 12,  0,  0,  4 },
  {  8,  4,  0,  4 },
  { 12,  4,  0,  4 },
  {  8,  0,  4,  4 },
  { 12,  0,  4,  4 },
  {  8,  4,  4,  4 },
  { 12,  4,  4,  4 },
  {  0,  8,  0,  0 },
  {  4,  8,  0,  0 },
  {  0, 12,  0,  0 },
  {  4, 12,  0,  0 },
  {  0,  8,  4,  0 },
  {  4,  8,  4,  0 },
  {  0, 12,  4,  0 },
  {  4, 12,  4,  0 },
  {  0,  8,  0,  4 },
  {  4,  8,  0,  4 },
  {  0, 12,  0,  4 },
  {  4, 12,  0,  4 },
  {  0,  8,  4,  4 },
  {  4,  8,  4,  4 },
  {  0, 12,  4,  4 },
  {  4, 12,  4,  4 },
  {  8,  8,  0,  0 },
  { 12,  8,  0,  0 },
  {  8, 12,  0,  0 },
  { 12, 12,  0,  0 },
  {  8,  8,  4,  0 },
  { 12,  8,  4,  0 },
  {  8, 12,  4,  0 },
  { 12, 12,  4,  0 },
  {  8,  8,  0,  4 },
  { 12,  8,  0,  4 },
  {  8, 12,  0,  4 },
  { 12, 12,  0,  4 },
  {  8,  8,  4,  4 },
  { 12,  8,  4,  4 },
  {  8, 12,  4,  4 },
  { 12, 12,  4,  4 },
  {  0,  0,  8,  0 },
  {  4,  0,  8,  0 },
  {  0,  4,  8,  0 },
  {  4,  4,  8,  0 },
  {  0,  0, 12,  0 },
  {  4,  0, 12,  0 },
  {  0,  4, 12,  0 },
  {  4,  4, 12,  0 },
  {  0,  0,  8,  4 },
  {  4,  0,  8,  4 },
  {  0,  4,  8,  4 },
  {  4,  4,  8,  4 },
  {  0,  0, 12,  4 },
  {  4,  0, 12,  4 },
  {  0,  4, 12,  4 },
  {  4,  4, 12,  4 },
  {  8,  0,  8,  0 },
  { 12,  0,  8,  0 },
  {  8,  4,  8,  0 },
  { 12,  4,  8,  0 },
  {  8,  0, 12,  0 },
  { 12,  0, 12,  0 },
  {  8,  4, 12,  0 },
  { 12,  4, 12,  0 },
  {  8,  0,  8,  4 },
  { 12,  0,  8,  4 },
  {  8,  4,  8,  4 },
  { 12,  4,  8,  4 },
  {  8,  0, 12,  4 },
  { 12,  0, 12,  4 },
  {  8,  4, 12,  4 },
  { 12,  4, 12,  4 },
  {  0,  8,  8,  0 },
  {  4,  8,  8,  0 },
  {  0, 12,  8,  0 },
  {  4, 12,  8,  0 },
  {  0,  8, 12,  0 },
  {  4,  8, 12,  0 },
  {  0, 12, 12,  0 },
  {  4, 12, 12,  0 },
  {  0,  8,  8,  4 },
  {  4,  8,  8,  4 },
  {  0, 12,  8,  4 },
  {  4, 12,  8,  4 },
  {  0,  8, 12,  4 },
  {  4,  8, 12,  4 },
  {  0, 12, 12,  4 },
  {  4, 12, 12,  4 },
  {  8,  8,  8,  0 },
  { 12,  8,  8,  0 },
  {  8, 12,  8,  0 },
  { 12, 12,  8,  0 },
  {  8,  8, 12,  0 },
  { 12,  8, 12,  0 },
  {  8, 12, 12,  0 },
  { 12, 12, 12,  0 },
  {  8,  8,  8,  4 },
  { 12,  8,  8,  4 },
  {  8, 12,  8,  4 },
  { 12, 12,  8,  4 },
  {  8,  8, 12,  4 },
  { 12,  8, 12,  4 },
  {  8, 12, 12,  4 },
  { 12, 12, 12,  4 },
  {  0,  0,  0,  8 },
  {  4,  0,  0,  8 },
  {  0,  4,  0,  8 },
  {  4,  4,  0,  8 },
  {  0,  0,  4,  8 },
  {  4,  0,  4,  8 },
  {  0,  4,  4,  8 },
  {  4,  4,  4,  8 },
  {  0,  0,  0, 12 },
  {  4,  0,  0, 12 },
  {  0,  4,  0, 12 },
  {  4,  4,  0, 12 },
  {  0,  0,  4, 12 },
  {  4,  0,  4, 12 },
  {  0,  4,  4, 12 },
  {  4,  4,  4, 12 },
  {  8,  0,  0,  8 },
  { 12,  0,  0,  8 },
  {  8,  4,  0,  8 },
  { 12,  4,  0,  8 },
  {  8,  0,  4,  8 },
  { 12,  0,  4,  8 },
  {  8,  4,  4,  8 },
  { 12,  4,  4,  8 },
  {  8,  0,  0, 12 },
  { 12,  0,  0, 12 },
  {  8,  4,  0, 12 },
  { 12,  4,  0, 12 },
  {  8,  0,  4, 12 },
  { 12,  0,  4, 12 },
  {  8,  4,  4, 12 },
  { 12,  4,  4, 12 },
  {  0,  8,  0,  8 },
  {  4,  8,  0,  8 },
  {  0, 12,  0,  8 },
  {  4, 12,  0,  8 },
  {  0,  8,  4,  8 },
  {  4,  8,  4,  8 },
  {  0, 12,  4,  8 },
  {  4, 12,  4,  8 },
  {  0,  8,  0, 12 },
  {  4,  8,  0, 12 },
  {  0, 12,  0, 12 },
  {  4, 12,  0, 12 },
  {  0,  8,  4, 12 },
  {  4,  8,  4, 12 },
  {  0, 12,  4, 12 },
  {  4, 12,  4, 12 },
  {  8,  8,  0,  8 },
  { 12,  8,  0,  8 },
  {  8, 12,  0,  8 },
  { 12, 12,  0,  8 },
  {  8,  8,  4,  8 },
  { 12,  8,  4,  8 },
  {  8, 12,  4,  8 },
  { 12, 12,  4,  8 },
  {  8,  8,  0, 12 },
  { 12,  8,  0, 12 },
  {  8, 12,  0, 12 },
  { 12, 12,  0, 12 },
  {  8,  8,  4, 12 },
  { 12,  8,  4, 12 },
  {  8, 12,  4, 12 },
  { 12, 12,  4, 12 },
  {  0,  0,  8,  8 },
  {  4,  0,  8,  8 },
  {  0,  4,  8,  8 },
  {  4,  4,  8,  8 },
  {  0,  0, 12,  8 },
  {  4,  0, 12,  8 },
  {  0,  4, 12,  8 },
  {  4,  4, 12,  8 },
  {  0,  0,  8, 12 },
  {  4,  0,  8, 12 },
  {  0,  4,  8, 12 },
  {  4,  4,  8, 12 },
  {  0,  0, 12, 12 },
  {  4,  0, 12, 12 },
  {  0,  4, 12, 12 },
  {  4,  4, 12, 12 },
  {  8,  0,  8,  8 },
  { 12,  0,  8,  8 },
  {  8,  4,  8,  8 },
  { 12,  4,  8,  8 },
  {  8,  0, 12,  8 },
  { 12,  0, 12,  8 },
  {  8,  4, 12,  8 },
  { 12,  4, 12,  8 },
  {  8,  0,  8, 12 },
  { 12,  0,  8, 12 },
  {  8,  4,  8, 12 },
  { 12,  4,  8, 12 },
  {  8,  0, 12, 12 },
  { 12,  0, 12, 12 },
  {  8,  4, 12, 12 },
  { 12,  4, 12, 12 },
  {  0,  8,  8,  8 },
  {  4,  8,  8,  8 },
  {  0, 12,  8,  8 },
  {  4, 12,  8,  8 },
  {  0,  8, 12,  8 },
  {  4,  8, 12,  8 },
  {  0, 12, 12,  8 },
  {  4, 12, 12,  8 },
  {  0,  8,  8, 12 },
  {  4,  8,  8, 12 },
  {  0, 12,  8, 12 },
  {  4, 12,  8, 12 },
  {  0,  8, 12, 12 },
  {  4,  8, 12, 12 },
  {  0, 12, 12, 12 },
  {  4, 12, 12, 12 },
  {  8,  8,  8,  8 },
  { 12,  8,  8,  8 },
  {  8, 12,  8,  8 },
  { 12, 12,  8,  8 },
  {  8,  8, 12,  8 },
  { 12,  8, 12,  8 },
  {  8, 12, 12,  8 },
  { 12, 12, 12,  8 },
  {  8,  8,  8, 12 },
  { 12,  8,  8, 12 },
  {  8, 12,  8, 12 },
  { 12, 12,  8, 12 },
  {  8,  8, 12, 12 },
  { 12,  8, 12, 12 },
  {  8, 12, 12, 12 },
  { 12, 12, 12, 12 }  };

byte tileConverterPlane4_5[256][4] =
{ {  0,  0,  0,  0 },
  { 16,  0,  0,  0 },
  {  0, 16,  0,  0 },
  { 16, 16,  0,  0 },
  {  0,  0, 16,  0 },
  { 16,  0, 16,  0 },
  {  0, 16, 16,  0 },
  { 16, 16, 16,  0 },
  {  0,  0,  0, 16 },
  { 16,  0,  0, 16 },
  {  0, 16,  0, 16 },
  { 16, 16,  0, 16 },
  {  0,  0, 16, 16 },
  { 16,  0, 16, 16 },
  {  0, 16, 16, 16 },
  { 16, 16, 16, 16 },
  { 32,  0,  0,  0 },
  { 48,  0,  0,  0 },
  { 32, 16,  0,  0 },
  { 48, 16,  0,  0 },
  { 32,  0, 16,  0 },
  { 48,  0, 16,  0 },
  { 32, 16, 16,  0 },
  { 48, 16, 16,  0 },
  { 32,  0,  0, 16 },
  { 48,  0,  0, 16 },
  { 32, 16,  0, 16 },
  { 48, 16,  0, 16 },
  { 32,  0, 16, 16 },
  { 48,  0, 16, 16 },
  { 32, 16, 16, 16 },
  { 48, 16, 16, 16 },
  {  0, 32,  0,  0 },
  { 16, 32,  0,  0 },
  {  0, 48,  0,  0 },
  { 16, 48,  0,  0 },
  {  0, 32, 16,  0 },
  { 16, 32, 16,  0 },
  {  0, 48, 16,  0 },
  { 16, 48, 16,  0 },
  {  0, 32,  0, 16 },
  { 16, 32,  0, 16 },
  {  0, 48,  0, 16 },
  { 16, 48,  0, 16 },
  {  0, 32, 16, 16 },
  { 16, 32, 16, 16 },
  {  0, 48, 16, 16 },
  { 16, 48, 16, 16 },
  { 32, 32,  0,  0 },
  { 48, 32,  0,  0 },
  { 32, 48,  0,  0 },
  { 48, 48,  0,  0 },
  { 32, 32, 16,  0 },
  { 48, 32, 16,  0 },
  { 32, 48, 16,  0 },
  { 48, 48, 16,  0 },
  { 32, 32,  0, 16 },
  { 48, 32,  0, 16 },
  { 32, 48,  0, 16 },
  { 48, 48,  0, 16 },
  { 32, 32, 16, 16 },
  { 48, 32, 16, 16 },
  { 32, 48, 16, 16 },
  { 48, 48, 16, 16 },
  {  0,  0, 32,  0 },
  { 16,  0, 32,  0 },
  {  0, 16, 32,  0 },
  { 16, 16, 32,  0 },
  {  0,  0, 48,  0 },
  { 16,  0, 48,  0 },
  {  0, 16, 48,  0 },
  { 16, 16, 48,  0 },
  {  0,  0, 32, 16 },
  { 16,  0, 32, 16 },
  {  0, 16, 32, 16 },
  { 16, 16, 32, 16 },
  {  0,  0, 48, 16 },
  { 16,  0, 48, 16 },
  {  0, 16, 48, 16 },
  { 16, 16, 48, 16 },
  { 32,  0, 32,  0 },
  { 48,  0, 32,  0 },
  { 32, 16, 32,  0 },
  { 48, 16, 32,  0 },
  { 32,  0, 48,  0 },
  { 48,  0, 48,  0 },
  { 32, 16, 48,  0 },
  { 48, 16, 48,  0 },
  { 32,  0, 32, 16 },
  { 48,  0, 32, 16 },
  { 32, 16, 32, 16 },
  { 48, 16, 32, 16 },
  { 32,  0, 48, 16 },
  { 48,  0, 48, 16 },
  { 32, 16, 48, 16 },
  { 48, 16, 48, 16 },
  {  0, 32, 32,  0 },
  { 16, 32, 32,  0 },
  {  0, 48, 32,  0 },
  { 16, 48, 32,  0 },
  {  0, 32, 48,  0 },
  { 16, 32, 48,  0 },
  {  0, 48, 48,  0 },
  { 16, 48, 48,  0 },
  {  0, 32, 32, 16 },
  { 16, 32, 32, 16 },
  {  0, 48, 32, 16 },
  { 16, 48, 32, 16 },
  {  0, 32, 48, 16 },
  { 16, 32, 48, 16 },
  {  0, 48, 48, 16 },
  { 16, 48, 48, 16 },
  { 32, 32, 32,  0 },
  { 48, 32, 32,  0 },
  { 32, 48, 32,  0 },
  { 48, 48, 32,  0 },
  { 32, 32, 48,  0 },
  { 48, 32, 48,  0 },
  { 32, 48, 48,  0 },
  { 48, 48, 48,  0 },
  { 32, 32, 32, 16 },
  { 48, 32, 32, 16 },
  { 32, 48, 32, 16 },
  { 48, 48, 32, 16 },
  { 32, 32, 48, 16 },
  { 48, 32, 48, 16 },
  { 32, 48, 48, 16 },
  { 48, 48, 48, 16 },
  {  0,  0,  0, 32 },
  { 16,  0,  0, 32 },
  {  0, 16,  0, 32 },
  { 16, 16,  0, 32 },
  {  0,  0, 16, 32 },
  { 16,  0, 16, 32 },
  {  0, 16, 16, 32 },
  { 16, 16, 16, 32 },
  {  0,  0,  0, 48 },
  { 16,  0,  0, 48 },
  {  0, 16,  0, 48 },
  { 16, 16,  0, 48 },
  {  0,  0, 16, 48 },
  { 16,  0, 16, 48 },
  {  0, 16, 16, 48 },
  { 16, 16, 16, 48 },
  { 32,  0,  0, 32 },
  { 48,  0,  0, 32 },
  { 32, 16,  0, 32 },
  { 48, 16,  0, 32 },
  { 32,  0, 16, 32 },
  { 48,  0, 16, 32 },
  { 32, 16, 16, 32 },
  { 48, 16, 16, 32 },
  { 32,  0,  0, 48 },
  { 48,  0,  0, 48 },
  { 32, 16,  0, 48 },
  { 48, 16,  0, 48 },
  { 32,  0, 16, 48 },
  { 48,  0, 16, 48 },
  { 32, 16, 16, 48 },
  { 48, 16, 16, 48 },
  {  0, 32,  0, 32 },
  { 16, 32,  0, 32 },
  {  0, 48,  0, 32 },
  { 16, 48,  0, 32 },
  {  0, 32, 16, 32 },
  { 16, 32, 16, 32 },
  {  0, 48, 16, 32 },
  { 16, 48, 16, 32 },
  {  0, 32,  0, 48 },
  { 16, 32,  0, 48 },
  {  0, 48,  0, 48 },
  { 16, 48,  0, 48 },
  {  0, 32, 16, 48 },
  { 16, 32, 16, 48 },
  {  0, 48, 16, 48 },
  { 16, 48, 16, 48 },
  { 32, 32,  0, 32 },
  { 48, 32,  0, 32 },
  { 32, 48,  0, 32 },
  { 48, 48,  0, 32 },
  { 32, 32, 16, 32 },
  { 48, 32, 16, 32 },
  { 32, 48, 16, 32 },
  { 48, 48, 16, 32 },
  { 32, 32,  0, 48 },
  { 48, 32,  0, 48 },
  { 32, 48,  0, 48 },
  { 48, 48,  0, 48 },
  { 32, 32, 16, 48 },
  { 48, 32, 16, 48 },
  { 32, 48, 16, 48 },
  { 48, 48, 16, 48 },
  {  0,  0, 32, 32 },
  { 16,  0, 32, 32 },
  {  0, 16, 32, 32 },
  { 16, 16, 32, 32 },
  {  0,  0, 48, 32 },
  { 16,  0, 48, 32 },
  {  0, 16, 48, 32 },
  { 16, 16, 48, 32 },
  {  0,  0, 32, 48 },
  { 16,  0, 32, 48 },
  {  0, 16, 32, 48 },
  { 16, 16, 32, 48 },
  {  0,  0, 48, 48 },
  { 16,  0, 48, 48 },
  {  0, 16, 48, 48 },
  { 16, 16, 48, 48 },
  { 32,  0, 32, 32 },
  { 48,  0, 32, 32 },
  { 32, 16, 32, 32 },
  { 48, 16, 32, 32 },
  { 32,  0, 48, 32 },
  { 48,  0, 48, 32 },
  { 32, 16, 48, 32 },
  { 48, 16, 48, 32 },
  { 32,  0, 32, 48 },
  { 48,  0, 32, 48 },
  { 32, 16, 32, 48 },
  { 48, 16, 32, 48 },
  { 32,  0, 48, 48 },
  { 48,  0, 48, 48 },
  { 32, 16, 48, 48 },
  { 48, 16, 48, 48 },
  {  0, 32, 32, 32 },
  { 16, 32, 32, 32 },
  {  0, 48, 32, 32 },
  { 16, 48, 32, 32 },
  {  0, 32, 48, 32 },
  { 16, 32, 48, 32 },
  {  0, 48, 48, 32 },
  { 16, 48, 48, 32 },
  {  0, 32, 32, 48 },
  { 16, 32, 32, 48 },
  {  0, 48, 32, 48 },
  { 16, 48, 32, 48 },
  {  0, 32, 48, 48 },
  { 16, 32, 48, 48 },
  {  0, 48, 48, 48 },
  { 16, 48, 48, 48 },
  { 32, 32, 32, 32 },
  { 48, 32, 32, 32 },
  { 32, 48, 32, 32 },
  { 48, 48, 32, 32 },
  { 32, 32, 48, 32 },
  { 48, 32, 48, 32 },
  { 32, 48, 48, 32 },
  { 48, 48, 48, 32 },
  { 32, 32, 32, 48 },
  { 48, 32, 32, 48 },
  { 32, 48, 32, 48 },
  { 48, 48, 32, 48 },
  { 32, 32, 48, 48 },
  { 48, 32, 48, 48 },
  { 32, 48, 48, 48 },
  { 48, 48, 48, 48 } };

byte tileConverterPlane6_7[256][4] =
{ {   0,   0,   0,   0 },
  {  64,   0,   0,   0 },
  {   0,  64,   0,   0 },
  {  64,  64,   0,   0 },
  {   0,   0,  64,   0 },
  {  64,   0,  64,   0 },
  {   0,  64,  64,   0 },
  {  64,  64,  64,   0 },
  {   0,   0,   0,  64 },
  {  64,   0,   0,  64 },
  {   0,  64,   0,  64 },
  {  64,  64,   0,  64 },
  {   0,   0,  64,  64 },
  {  64,   0,  64,  64 },
  {   0,  64,  64,  64 },
  {  64,  64,  64,  64 },
  { 128,   0,   0,   0 },
  { 192,   0,   0,   0 },
  { 128,  64,   0,   0 },
  { 192,  64,   0,   0 },
  { 128,   0,  64,   0 },
  { 192,   0,  64,   0 },
  { 128,  64,  64,   0 },
  { 192,  64,  64,   0 },
  { 128,   0,   0,  64 },
  { 192,   0,   0,  64 },
  { 128,  64,   0,  64 },
  { 192,  64,   0,  64 },
  { 128,   0,  64,  64 },
  { 192,   0,  64,  64 },
  { 128,  64,  64,  64 },
  { 192,  64,  64,  64 },
  {   0, 128,   0,   0 },
  {  64, 128,   0,   0 },
  {   0, 192,   0,   0 },
  {  64, 192,   0,   0 },
  {   0, 128,  64,   0 },
  {  64, 128,  64,   0 },
  {   0, 192,  64,   0 },
  {  64, 192,  64,   0 },
  {   0, 128,   0,  64 },
  {  64, 128,   0,  64 },
  {   0, 192,   0,  64 },
  {  64, 192,   0,  64 },
  {   0, 128,  64,  64 },
  {  64, 128,  64,  64 },
  {   0, 192,  64,  64 },
  {  64, 192,  64,  64 },
  { 128, 128,   0,   0 },
  { 192, 128,   0,   0 },
  { 128, 192,   0,   0 },
  { 192, 192,   0,   0 },
  { 128, 128,  64,   0 },
  { 192, 128,  64,   0 },
  { 128, 192,  64,   0 },
  { 192, 192,  64,   0 },
  { 128, 128,   0,  64 },
  { 192, 128,   0,  64 },
  { 128, 192,   0,  64 },
  { 192, 192,   0,  64 },
  { 128, 128,  64,  64 },
  { 192, 128,  64,  64 },
  { 128, 192,  64,  64 },
  { 192, 192,  64,  64 },
  {   0,   0, 128,   0 },
  {  64,   0, 128,   0 },
  {   0,  64, 128,   0 },
  {  64,  64, 128,   0 },
  {   0,   0, 192,   0 },
  {  64,   0, 192,   0 },
  {   0,  64, 192,   0 },
  {  64,  64, 192,   0 },
  {   0,   0, 128,  64 },
  {  64,   0, 128,  64 },
  {   0,  64, 128,  64 },
  {  64,  64, 128,  64 },
  {   0,   0, 192,  64 },
  {  64,   0, 192,  64 },
  {   0,  64, 192,  64 },
  {  64,  64, 192,  64 },
  { 128,   0, 128,   0 },
  { 192,   0, 128,   0 },
  { 128,  64, 128,   0 },
  { 192,  64, 128,   0 },
  { 128,   0, 192,   0 },
  { 192,   0, 192,   0 },
  { 128,  64, 192,   0 },
  { 192,  64, 192,   0 },
  { 128,   0, 128,  64 },
  { 192,   0, 128,  64 },
  { 128,  64, 128,  64 },
  { 192,  64, 128,  64 },
  { 128,   0, 192,  64 },
  { 192,   0, 192,  64 },
  { 128,  64, 192,  64 },
  { 192,  64, 192,  64 },
  {   0, 128, 128,   0 },
  {  64, 128, 128,   0 },
  {   0, 192, 128,   0 },
  {  64, 192, 128,   0 },
  {   0, 128, 192,   0 },
  {  64, 128, 192,   0 },
  {   0, 192, 192,   0 },
  {  64, 192, 192,   0 },
  {   0, 128, 128,  64 },
  {  64, 128, 128,  64 },
  {   0, 192, 128,  64 },
  {  64, 192, 128,  64 },
  {   0, 128, 192,  64 },
  {  64, 128, 192,  64 },
  {   0, 192, 192,  64 },
  {  64, 192, 192,  64 },
  { 128, 128, 128,   0 },
  { 192, 128, 128,   0 },
  { 128, 192, 128,   0 },
  { 192, 192, 128,   0 },
  { 128, 128, 192,   0 },
  { 192, 128, 192,   0 },
  { 128, 192, 192,   0 },
  { 192, 192, 192,   0 },
  { 128, 128, 128,  64 },
  { 192, 128, 128,  64 },
  { 128, 192, 128,  64 },
  { 192, 192, 128,  64 },
  { 128, 128, 192,  64 },
  { 192, 128, 192,  64 },
  { 128, 192, 192,  64 },
  { 192, 192, 192,  64 },
  {   0,   0,   0, 128 },
  {  64,   0,   0, 128 },
  {   0,  64,   0, 128 },
  {  64,  64,   0, 128 },
  {   0,   0,  64, 128 },
  {  64,   0,  64, 128 },
  {   0,  64,  64, 128 },
  {  64,  64,  64, 128 },
  {   0,   0,   0, 192 },
  {  64,   0,   0, 192 },
  {   0,  64,   0, 192 },
  {  64,  64,   0, 192 },
  {   0,   0,  64, 192 },
  {  64,   0,  64, 192 },
  {   0,  64,  64, 192 },
  {  64,  64,  64, 192 },
  { 128,   0,   0, 128 },
  { 192,   0,   0, 128 },
  { 128,  64,   0, 128 },
  { 192,  64,   0, 128 },
  { 128,   0,  64, 128 },
  { 192,   0,  64, 128 },
  { 128,  64,  64, 128 },
  { 192,  64,  64, 128 },
  { 128,   0,   0, 192 },
  { 192,   0,   0, 192 },
  { 128,  64,   0, 192 },
  { 192,  64,   0, 192 },
  { 128,   0,  64, 192 },
  { 192,   0,  64, 192 },
  { 128,  64,  64, 192 },
  { 192,  64,  64, 192 },
  {   0, 128,   0, 128 },
  {  64, 128,   0, 128 },
  {   0, 192,   0, 128 },
  {  64, 192,   0, 128 },
  {   0, 128,  64, 128 },
  {  64, 128,  64, 128 },
  {   0, 192,  64, 128 },
  {  64, 192,  64, 128 },
  {   0, 128,   0, 192 },
  {  64, 128,   0, 192 },
  {   0, 192,   0, 192 },
  {  64, 192,   0, 192 },
  {   0, 128,  64, 192 },
  {  64, 128,  64, 192 },
  {   0, 192,  64, 192 },
  {  64, 192,  64, 192 },
  { 128, 128,   0, 128 },
  { 192, 128,   0, 128 },
  { 128, 192,   0, 128 },
  { 192, 192,   0, 128 },
  { 128, 128,  64, 128 },
  { 192, 128,  64, 128 },
  { 128, 192,  64, 128 },
  { 192, 192,  64, 128 },
  { 128, 128,   0, 192 },
  { 192, 128,   0, 192 },
  { 128, 192,   0, 192 },
  { 192, 192,   0, 192 },
  { 128, 128,  64, 192 },
  { 192, 128,  64, 192 },
  { 128, 192,  64, 192 },
  { 192, 192,  64, 192 },
  {   0,   0, 128, 128 },
  {  64,   0, 128, 128 },
  {   0,  64, 128, 128 },
  {  64,  64, 128, 128 },
  {   0,   0, 192, 128 },
  {  64,   0, 192, 128 },
  {   0,  64, 192, 128 },
  {  64,  64, 192, 128 },
  {   0,   0, 128, 192 },
  {  64,   0, 128, 192 },
  {   0,  64, 128, 192 },
  {  64,  64, 128, 192 },
  {   0,   0, 192, 192 },
  {  64,   0, 192, 192 },
  {   0,  64, 192, 192 },
  {  64,  64, 192, 192 },
  { 128,   0, 128, 128 },
  { 192,   0, 128, 128 },
  { 128,  64, 128, 128 },
  { 192,  64, 128, 128 },
  { 128,   0, 192, 128 },
  { 192,   0, 192, 128 },
  { 128,  64, 192, 128 },
  { 192,  64, 192, 128 },
  { 128,   0, 128, 192 },
  { 192,   0, 128, 192 },
  { 128,  64, 128, 192 },
  { 192,  64, 128, 192 },
  { 128,   0, 192, 192 },
  { 192,   0, 192, 192 },
  { 128,  64, 192, 192 },
  { 192,  64, 192, 192 },
  {   0, 128, 128, 128 },
  {  64, 128, 128, 128 },
  {   0, 192, 128, 128 },
  {  64, 192, 128, 128 },
  {   0, 128, 192, 128 },
  {  64, 128, 192, 128 },
  {   0, 192, 192, 128 },
  {  64, 192, 192, 128 },
  {   0, 128, 128, 192 },
  {  64, 128, 128, 192 },
  {   0, 192, 128, 192 },
  {  64, 192, 128, 192 },
  {   0, 128, 192, 192 },
  {  64, 128, 192, 192 },
  {   0, 192, 192, 192 },
  {  64, 192, 192, 192 },
  { 128, 128, 128, 128 },
  { 192, 128, 128, 128 },
  { 128, 192, 128, 128 },
  { 192, 192, 128, 128 },
  { 128, 128, 192, 128 },
  { 192, 128, 192, 128 },
  { 128, 192, 192, 128 },
  { 192, 192, 192, 128 },
  { 128, 128, 128, 192 },
  { 192, 128, 128, 192 },
  { 128, 192, 128, 192 },
  { 192, 192, 128, 192 },
  { 128, 128, 192, 192 },
  { 192, 128, 192, 192 },
  { 128, 192, 192, 192 },
  { 192, 192, 192, 192 } };

struct tCache TileCache; 
  
void resetTileConverter(void)
{
   int i,j;
    
   for(j=0; j<3; j++)
      for(i=0; i<0x1000; i++)  
            TileCache.valid[j][i] = 0;
}


byte ConvertTile (byte* dest, dword TileAddr)
{
     byte* tiledata;
     byte line;
     byte blank_tile = 0;
   
     tiledata = &PPU.VRAM[TileAddr];	
	
    /*start converting tile*/
   switch( BG.BitShift )//the color depth
   {
   	case 2:         
   		for (line = 8; line != 0; line--, tiledata += 2, dest+=8)
		{	
			byte plane0, plane1, combined;
			
			plane0 = *tiledata;
			plane1 = *(tiledata+1);
                		
                		/*draw first 4 bits of the current tile line*/
			combined = (plane0 & 0xF) | (plane1 << 4);
			blank_tile |= combined;
			
			*(dest+7)= tileConverterPlane0_1[combined][0];
			*(dest+6)= tileConverterPlane0_1[combined][1];
			*(dest+5)= tileConverterPlane0_1[combined][2];
			*(dest+4)= tileConverterPlane0_1[combined][3];
						
             			/*draw last 4 bits of the current tile line*/		              			              	
             			combined = ( plane0 >> 4) | (plane1 & 0xF0);
                                          blank_tile |= combined;
                                          
             			*(dest+3)= tileConverterPlane0_1[combined][0];
			*(dest+2)= tileConverterPlane0_1[combined][1];
			*(dest+1)= tileConverterPlane0_1[combined][2];
			*(dest+0)= tileConverterPlane0_1[combined][3];
             			
             		}
   		break;
   		
   	case 4:
   		for (line = 8; line != 0; line--, tiledata += 2, dest+=8)
		{	
			byte plane0, plane1, plane2, plane3, combined;
			byte pix0, pix1, pix2, pix3;
			
			plane0 = *tiledata;
			plane1 = *(tiledata+1);
			plane2 = *(tiledata+16);
			plane3 = *(tiledata+17);
                                          			
			/*draw first 4 bits of the current tile line*/
			
			combined = (plane0 & 0xF) | (plane1 << 4);
			blank_tile |= combined;
			
			pix0 = tileConverterPlane0_1[combined][0];
			pix1 = tileConverterPlane0_1[combined][1];
			pix2 = tileConverterPlane0_1[combined][2];
			pix3 = tileConverterPlane0_1[combined][3];			
			
			combined = (plane2 & 0xF) | (plane3 << 4);
			blank_tile |= combined;
			
			pix0 |= tileConverterPlane2_3[combined][0];
			pix1 |= tileConverterPlane2_3[combined][1];
			pix2 |= tileConverterPlane2_3[combined][2];
			pix3 |= tileConverterPlane2_3[combined][3];			
			
			*(dest+7)= pix0;
			*(dest+6)= pix1;
			*(dest+5)= pix2;
			*(dest+4)= pix3;
						
            			/*draw last 4 bits of the current tile line*/		              			              	
             			combined = ( plane0 >> 4) | (plane1 & 0xF0);
			blank_tile |= combined;
			
			pix0 = tileConverterPlane0_1[combined][0];
			pix1 = tileConverterPlane0_1[combined][1];
			pix2 = tileConverterPlane0_1[combined][2];
			pix3 = tileConverterPlane0_1[combined][3];			
			
                                         	combined = ( plane2 >> 4) | (plane3 & 0xF0);
			blank_tile |= combined;
                                         	
			pix0 |= tileConverterPlane2_3[combined][0];
			pix1 |= tileConverterPlane2_3[combined][1];
			pix2 |= tileConverterPlane2_3[combined][2];
			pix3 |= tileConverterPlane2_3[combined][3];			
			
			*(dest+3)= pix0;
			*(dest+2)= pix1;
			*(dest+1)= pix2;
			*(dest+0)= pix3;
             					
             		}
   		break;
   	   		
   	case 8:
   		for (line = 8; line != 0; line--, tiledata += 2, dest+=8)
		{	
			byte plane0, plane1, plane2, plane3, plane4, plane5, plane6, plane7, combined;
			byte pix0, pix1, pix2, pix3;

			plane0 = *tiledata;
			plane1 = *(tiledata+1);
			plane2 = *(tiledata+16);
			plane3 = *(tiledata+17);
			plane4 = *(tiledata+32);
			plane5 = *(tiledata+33);
			plane6 = *(tiledata+48);
			plane7 = *(tiledata+49);
                                          
                                          			
			/*draw first 4 bits of the current tile line*/
			
			combined = (plane0 & 0xF) | (plane1 << 4);
			blank_tile |= combined;
			
			pix0 = tileConverterPlane0_1[combined][0];
			pix1 = tileConverterPlane0_1[combined][1];
			pix2 = tileConverterPlane0_1[combined][2];
			pix3 = tileConverterPlane0_1[combined][3];			
			
                                         	combined = (plane2 & 0xF) | (plane3 << 4);
                                         	blank_tile |= combined;
			
			pix0 |= tileConverterPlane2_3[combined][0];
			pix1 |= tileConverterPlane2_3[combined][1];
			pix2 |= tileConverterPlane2_3[combined][2];
			pix3 |= tileConverterPlane2_3[combined][3];			

			combined = (plane4 & 0xF) | (plane5 << 4);
			blank_tile |= combined;
			
			pix0 |= tileConverterPlane4_5[combined][0];
			pix1 |= tileConverterPlane4_5[combined][1];
			pix2 |= tileConverterPlane4_5[combined][2];
			pix3 |= tileConverterPlane4_5[combined][3];			
			
			combined = (plane6 & 0xF) | (plane7 << 4);
			blank_tile |= combined;
			
			pix0 |= tileConverterPlane6_7[combined][0];
			pix1 |= tileConverterPlane6_7[combined][1];
			pix2 |= tileConverterPlane6_7[combined][2];
			pix3 |= tileConverterPlane6_7[combined][3];			
								
			*(dest+7)= pix0;
			*(dest+6)= pix1;
			*(dest+5)= pix2;
			*(dest+4)= pix3;


             			/*draw last 4 bits of the current tile line*/		              			              	
             			combined = ( plane0 >> 4) | (plane1 & 0xF0);
             			blank_tile |= combined;
						
			pix0 = tileConverterPlane0_1[combined][0];
			pix1 = tileConverterPlane0_1[combined][1];
			pix2 = tileConverterPlane0_1[combined][2];
			pix3 = tileConverterPlane0_1[combined][3];			
			
                                         	combined = ( plane2 >> 4) | (plane3 & 0xF0);
                                         	blank_tile |= combined;
			
			pix0 |= tileConverterPlane2_3[combined][0];
			pix1 |= tileConverterPlane2_3[combined][1];
			pix2 |= tileConverterPlane2_3[combined][2];
			pix3 |= tileConverterPlane2_3[combined][3];			

			combined =  ( plane4 >> 4) | (plane5 & 0xF0);
			blank_tile |= combined;
			
			pix0 |= tileConverterPlane4_5[combined][0];
			pix1 |= tileConverterPlane4_5[combined][1];
			pix2 |= tileConverterPlane4_5[combined][2];
			pix3 |= tileConverterPlane4_5[combined][3];			
			
			combined =  ( plane6 >> 4) | (plane7 & 0xF0);
			blank_tile |= combined;
			
			pix0 |= tileConverterPlane6_7[combined][0];
			pix1 |= tileConverterPlane6_7[combined][1];
			pix2 |= tileConverterPlane6_7[combined][2];
			pix3 |= tileConverterPlane6_7[combined][3];			
						
			*(dest+3)= pix0;
			*(dest+2)= pix1;
			*(dest+1)= pix2;
			*(dest+0)= pix3;
             					
             		}
   		break;
   		                                    
   }

   return blank_tile ? 1 : BLANK_TILE ;
}

/*
 This functions draw the tile passed as argument in the screen
*/

void DrawTile ( dword Tile, int x ,int y, int StartPixel, int Width,int StartLine,int LineCount)
{
     
    byte tileColorsBase;    
    
    dword TileAddr = BG.TileAddress + ((Tile & 0x3ff) << BG.TileShift); 
    
    word TileNumber; 
    
    byte* tileData;
                                 
    if ((Tile & 0x1ff) >= 256) 
	TileAddr += BG.NameSelect; 

    TileAddr &= 0xFFFF; 

    tileData = &BG.CacheBuffer[(TileNumber = (TileAddr >> BG.TileShift)) << 6]; 

    if (!BG.CacheValidation [TileNumber]) 
    	BG.CacheValidation[TileNumber] = ConvertTile (tileData, TileAddr); 

    if (BG.CacheValidation [TileNumber] == BLANK_TILE) 
    	return; 

    tileColorsBase =( ( (Tile >> 10) & BG.PaletteMask) << BG.PaletteShift) + BG.StartPalette;    
                                                                                                                                                                 
    if ( !(Tile & (V_FLIP | H_FLIP)) ) 
	    renderTile( tileData, tileColorsBase , x, y,StartPixel,Width,StartLine,LineCount);
	    
    else if (!(Tile & V_FLIP))   
    	    renderTileHflip( tileData, tileColorsBase , x, y,StartPixel,Width,StartLine,LineCount);
    
    else if (Tile & H_FLIP)
    	    renderTileHVflip( tileData, tileColorsBase , x, y,StartPixel,Width,StartLine,LineCount);
    
    else 
        	    renderTileVflip( tileData, tileColorsBase , x, y,StartPixel,Width,StartLine,LineCount);
}
